# @legion/plan-executor

A flexible plan execution engine for Legion that orchestrates the execution of plans using available Legion modules and tools.

## Features

- ðŸŽ¯ **Native llm-planner support** - Execute plans generated by `@legion/llm-planner`
- ðŸ”Œ **Dynamic module loading** - Load only the tools needed for each plan
- ðŸ“Š **Progress tracking** - Real-time execution progress with event emission
- ðŸ”„ **Retry logic** - Configurable retry attempts with exponential backoff
- âš¡ **Parallel execution** - Execute independent steps concurrently
- ðŸ’¾ **Checkpoint support** - Save and resume execution state
- ðŸ› ï¸ **Format adapters** - Support for multiple plan formats

## Installation

```bash
npm install @legion/plan-executor
```

## Quick Start

```javascript
import { PlanExecutorModule } from '@legion/plan-executor';
import { ModuleFactory, ResourceManager } from '@legion/module-loader';

// Initialize Legion infrastructure
const resourceManager = new ResourceManager();
await resourceManager.initialize();
const moduleFactory = new ModuleFactory(resourceManager);

// Create executor module
const executorModule = moduleFactory.createModule(PlanExecutorModule);
const [executeTool] = executorModule.getTools();

// Execute a plan
const result = await executeTool.execute({
  plan: {
    id: 'example-plan',
    name: 'Example Plan',
    steps: [
      {
        id: 'step1',
        name: 'Read file',
        actions: [{
          type: 'file_read',
          parameters: { path: 'input.txt' }
        }]
      }
    ]
  },
  options: {
    emitProgress: true
  }
});

console.log(result);
// { success: true, completedSteps: ['step1'], results: {...} }
```

## Usage with Progress Monitoring

```javascript
// Listen for execution events
executorModule.on('progress', (event) => {
  console.log(`Progress: ${event.percentage}% - Step: ${event.stepId}`);
});

executorModule.on('step:complete', (event) => {
  console.log(`Completed step ${event.stepId} in ${event.duration}ms`);
});

// Execute with progress enabled
const result = await executeTool.execute({
  plan: myPlan,
  options: { emitProgress: true }
});
```

## Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `parallel` | boolean | false | Execute independent steps in parallel |
| `stopOnError` | boolean | true | Stop execution on first error |
| `emitProgress` | boolean | true | Emit progress events during execution |
| `timeout` | number | 300000 | Step execution timeout in milliseconds |
| `retries` | number | 3 | Number of retry attempts for failed steps |

## Plan Format

The executor supports llm-planner's hierarchical plan format:

```javascript
{
  id: "plan-123",
  name: "My Plan",
  description: "Plan description",
  steps: [
    {
      id: "step1",
      name: "First Step",
      type: "implementation",
      actions: [
        {
          type: "tool_name",
          parameters: { /* tool parameters */ }
        }
      ]
    },
    {
      id: "step2", 
      name: "Second Step",
      dependencies: ["step1"], // Depends on step1
      actions: [/* ... */]
    }
  ]
}
```

## Documentation

- [Design Document](docs/DESIGN.md) - Comprehensive design and architecture
- [API Reference](docs/API.md) - Detailed API documentation
- [Examples](examples/) - Usage examples and patterns

## License

MIT